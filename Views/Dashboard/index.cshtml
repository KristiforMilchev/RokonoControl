
@{
    ViewData["Title"] = "Home Page";
    Layout = "~/Views/Shared/_LayoutProjects.cshtml";
    var result = ViewData["Projects"] as List<Projects>;
    var userName =  ViewData["Name"] as string;
}
<link href="~/Syncfusion/ej2/material.css" rel="stylesheet" />
<div class="page-title-heading">
    <div class="page-title-icon">
        <i class="pe-7s-graph text-success">
        </i>
    </div>
    <div>Project Dashboard
        <div class="page-title-subheading">Welcome Back @userName 
        </div>
    </div>
</div>
<div class="row">
    <div class="col-md-12">
        <div class="main-card mb-3 card">
            <div class="card-body text-center">
                 
                <div class="row">
                    <a href="#" class="btn btn-block btn-info" data-toggle="modal" data-target=".bd-example-modal-lg"><span class="glyphicon glyphicon-file"></span> Create New Project</a>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="row">
<div class="col-md-12">
  <div class="main-card mb-3 card">
        <div class="card-body"><h5 class="card-title text-center">Select a project</h5>
            <table class="mb-0 table table-hover">
                <thead>
                <tr>
                    <th>#</th>
                    <th>Project Name</th>
                    <th>Description</th>
                    <th>Date</th>
                    <th>Work Items</th>
                    <th>Build</th>
                    <th>Tests</th>
                </tr>
                </thead>
                <tbody>

                    @{
                        foreach(var item in result){
                            <tr>
                                <th scope="row">1</th>
                                <td><a href="/Dashboard/ProjectDashboard?id=@item.Id">@item.ProjectName</a></td>
                                <td>@item.ProjectDescription</td>
                                <td>@item.CreationDate</td>
                                <td><i class="fas fa-briefcase"></i></td>
                                <td><i class="fas fa-shapes"></i></td>
                                <td><i class="fas fa-vial"></i></td>

                            </tr>
                        }
                    }
             
               
                </tbody>
            </table>
        </div>
    </div>
</div>
</div>
<script
  src="https://code.jquery.com/jquery-3.4.1.js"
  integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU="
  crossorigin="anonymous"></script>
 <script src="~/Syncfusion/ej2/dist/ej2.min.js"></script>

<script>

    var grid;
    $( document ).ready(function() 
    {
        $.ajax({
            type: 'GET',
            url: '/Authenication/GetUsers',
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (response) {
                LoadAccounts(response);
            },
            error: function (xhr, status, error) {
    
            }
        });
        
    });
    function LoadAccounts(data){
        grid = new ej.grids.Grid({
            dataSource: data,
            allowPaging: true,
            allowSelection: true,
            selectionSettings: { persistSelection: true },
            editSettings: { allowDeleting: true },
            toolbar: [ 'Delete' ],
            enableHover: false,
            columns: [
                { type: 'checkbox', width: 50 },
                { field: 'name', isPrimaryKey: true, headerText: 'Name', width: 180 },
               
            ],
            pageSettings: { pageCount: 2 }
        });
        grid.appendTo('#Grid');
    }  

    function CreateNewProject()
    {
        console.log("in");
        var dto = {
            "ProjectName": $("#ProjectName").val(),
            "ProjectDescription" : $("#Description").val(),
            "Users" : grid.getSelectedRecords()// get the selected records.
        }
         $.ajax({
            type: 'POST',
            url: '/Dashboard/AddNewProject',
            data: JSON.stringify(dto),
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (response) {
                window.location.href = "/Dashboard/Index";
            },
            error: function (xhr, status, error) {
                console.log(error);
            }
        });
    }  
</script>